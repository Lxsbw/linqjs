class Linq{constructor(e=[]){this._elements=e}add(e){this._elements.push(e)}append(e){this.add(e)}prepend(e){this._elements.unshift(e)}addRange(e){this._elements.push(...e)}aggregate(e,t){return this._elements.reduce(e,t)}all(e){return this._elements.every(e)}any(e){return e?this._elements.some(e):0<this._elements.length}average(e){return Tools.calcNumDiv(this.sum(e),this.count())}cast(){return new Linq(this._elements)}clear(){this._elements.length=0}concat(e){return new Linq(this._elements.concat(e.toArray()))}contains(t){return this.any(e=>e===t)}count(e){return e?this.where(e).count():this._elements.length}defaultIfEmpty(e){return this.count()?this:new Linq([e])}distinct(){return this.where((t,e,r)=>(Tools.isObject(t)?r.findIndex(e=>Tools.equal(e,t)):r.indexOf(t))===e)}distinctBy(e){let n=this.groupBy(e);return new Linq(n).select(e=>e.key).toArray().reduce(function(e,t){var r=new Linq(n).firstOrDefault(e=>Tools.equal(e.key,t));return e.add(r.elements[0]),e},new Linq)}distinctMap(e){return(e?this.select(e):this).distinct()}elementAt(e){if(e<this.count()&&0<=e)return this._elements[e];throw new Error("ArgumentOutOfRangeException: index is less than 0 or greater than or equal to the number of elements in source.")}elementAtOrDefault(e){return e<this.count()&&0<=e?this._elements[e]:void 0}except(t){return this.where(e=>!t.contains(e))}first(e){if(this.count())return e?this.where(e).first():this._elements[0];throw new Error("InvalidOperationException: The source sequence is empty.")}firstOrDefault(e){return this.count(e)?this.first(e):void 0}forEach(e){return this._elements.forEach(e)}groupBy(e,t=e=>e){var r,n=new Map;for(r of this._elements){var s=Tools.getHash(e(r)),i=t(r),s=(n.has(s)||n.set(s,{key:e(r),count:0,elements:[]}),n.get(s));s.elements.push(i),s.count++}return Array.from(n.values())}groupByMini(s,i=e=>e){return this.aggregate(function(e,t){let r=s(t);var n=new Linq(e).firstOrDefault(e=>Tools.equal(e.key,r)),t=i(t);return n?(n.elements.push(t),n.count++):(n={key:r,count:1,elements:[t]},e.push(n)),e},[])}groupJoin(e,r,n,s){return this.select(t=>s(t,e.where(e=>r(t)===n(e))))}indexOf(e){return this._elements.indexOf(e)}insert(e,t){if(e<0||e>this._elements.length)throw new Error("Index is out of range.");this._elements.splice(e,0,t)}intersect(t){return this.where(e=>t.contains(e))}join(e,r,n,s){return this.selectMany(t=>e.where(e=>n(e)===r(t)).select(e=>s(t,e)))}last(e){if(this.count())return e?this.where(e).last():this._elements[this.count()-1];throw Error("InvalidOperationException: The source sequence is empty.")}lastOrDefault(e){return this.count(e)?this.last(e):void 0}max(e){return Math.max(...this._elements.map(e||(e=>e)))}min(e){return Math.min(...this._elements.map(e||(e=>e)))}ofType(t){let r;switch(t){case Number:r="number";break;case String:r="string";break;case Boolean:r=typeof!0;break;case Function:r="function";break;default:r=null}return(null===r?this.where(e=>e instanceof t):this.where(e=>typeof e===r)).cast()}orderBy(e,t=Tools.keyComparer(e,!1)){return new OrderedList(Tools.arrayMap(this._elements),t)}orderByDescending(e,t=Tools.keyComparer(e,!0)){return new OrderedList(Tools.arrayMap(this._elements),t)}thenBy(e){return this.orderBy(e)}thenByDescending(e){return this.orderByDescending(e)}remove(e){return-1!==this.indexOf(e)&&(this.removeAt(this.indexOf(e)),!0)}removeAll(e){return this.where(Tools.negate(e))}removeAt(e){this._elements.splice(e,1)}reverse(){return new Linq(this._elements.reverse())}select(e){return new Linq(this._elements.map(e))}selectMany(n){return this.aggregate((e,t,r)=>(e.addRange(this.select(n).elementAt(r).toArray()),e),new Linq)}sequenceEqual(t){return this.all(e=>t.contains(e))}single(e){if(1!==this.count(e))throw new Error("The collection does not contain exactly one element.");return this.first(e)}singleOrDefault(e){return this.count(e)?this.single(e):void 0}skip(e){return new Linq(this._elements.slice(Math.max(0,e)))}skipLast(e){return new Linq(this._elements.slice(0,-Math.max(0,e)))}skipWhile(t){return this.skip(this.aggregate(e=>t(this.elementAt(e))?++e:e,0))}sum(e){return e?this.select(e).sum():this.aggregate((e,t)=>Tools.calcNum(e,+t),0)}take(e){return new Linq(this._elements.slice(0,Math.max(0,e)))}takeLast(e){return new Linq(this._elements.slice(-Math.max(0,e)))}takeWhile(t){return this.take(this.aggregate(e=>t(this.elementAt(e))?++e:e,0))}toArray(){return this._elements}toDictionary(n,s){return this.aggregate((e,t,r)=>(e.add({Key:this.select(n).elementAt(r),Value:s?this.select(s).elementAt(r):t}),e),new Linq)}toList(){return this}toLookup(e,t){return this.groupBy(e,t)}union(e){return this.concat(e).distinct()}where(e){return new Linq(this._elements.filter(e))}zip(r,n){return r.count()<this.count()?r.select((e,t)=>n(this.elementAt(t),e)):this.select((e,t)=>n(e,r.elementAt(t)))}}class OrderedList extends Linq{constructor(e,t){super(e),this._comparer=t,this._elements.sort(this._comparer)}thenBy(e){return new OrderedList(this._elements,Tools.composeComparers(this._comparer,Tools.keyComparer(e,!1)))}thenByDescending(e){return new OrderedList(this._elements,Tools.composeComparers(this._comparer,Tools.keyComparer(e,!0)))}}let Tools={isObject(e){return!!e&&"object"==typeof e},equal(e,t){var r,n,s;return e===t||typeof e==typeof t&&(this.isObject(e)&&this.isObject(t)?(r=[e,t].map(e=>e.constructor))[0]===r[1]&&(e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():e instanceof RegExp&&t instanceof RegExp?e.toString()===t.toString():(r=Object.entries(e),n=Object.entries(t),r.length===n.length&&(s=(e,r)=>e.every(([e,t])=>this.isObject(t)?this.equal(r[e],t):r[e]===t))(r,t)&&s(n,e))):e===t)},negate(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return!r.apply(void 0,e)}},composeComparers(r,n){return(e,t)=>r(e,t)||n(e,t)},keyComparer(s,i){return(e,t)=>{var r,n,e=s(e),t=s(t);return this.isString(e)&&this.isString(t)?(n=t,0<(r=e).localeCompare(n)?i?-1:1:0<n.localeCompare(r)?i?1:-1:0):(n=t)<(r=e)?i?-1:1:r<n?i?1:-1:0}},calcNum(e,t){var r,n;return this.isNum(e)&&this.isNum(t)?({mult:r,place:n}=this.calcMultiple(e,t),Number(((e*r+t*r)/r).toFixed(n))):0},calcNumDiv(e,t){var r;return this.isNum(e)&&this.isNum(t)?(r=this.calcMultiple(e,t).mult,e*r/(t*r)):0},isNum(e){return"number"==typeof e&&!isNaN(e)},isString(e){return"string"==typeof e&&e.constructor===String},isArray(e){return Array.isArray(e)},calcMultiple(e,t){e=e.toString().split("."),t=t.toString().split("."),e=1<e.length?e[1].length:0,t=1<t.length?t[1].length:0;return{mult:Math.pow(10,Math.max(e,t)),place:t<=e?e:t}},arrayMap(e){return this.isArray(e)?e.map(e=>e):e},getGroupValue(e){return null==e?"":e},cloneDeep(e){if("function"==typeof structuredClone)return structuredClone(e);let t;if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return(t=new Date).setTime(e.getTime()),t;if(e instanceof RegExp)return t=e;if(e instanceof Array){for(var r in t=[],e)e.hasOwnProperty(r)&&t.push(this.cloneDeep(e[r]));return t}if(e instanceof Object){for(var n in t={},e)e.hasOwnProperty(n)&&(t[n]=this.cloneDeep(e[n]));return t}},getHash(e){let n="";return function t(r){var e=Object.prototype.toString.call(r).slice(8,-1).toLowerCase();switch(e){case"object":Object.keys(r).sort().forEach(e=>{n+=`${e}:${t(r[e])};`});break;case"array":r.forEach(e=>{n+=t(e)+","});break;case"boolean":n+="boolean<>_<>_<>"+r.toString();break;case"null":n+="null<>_<>_<>";break;case"undefined":n+="undefined<>_<>_<>";break;default:n+=r?r.toString():""}return n}(e)}};"undefined"!=typeof module&&void 0!==module.exports?module.exports=Linq:window.Linq=Linq;